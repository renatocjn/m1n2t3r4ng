
<nav class="navbar navbar-expand-lg navbar-light bg-light">
  <span class="navbar-brand" href="#">
      <%= image_tag :logo_casebras, height: "35px", width: "35px" %>
      Monitoramento Casebrás
  </span>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="navbarSupportedContent">
    <ul class="navbar-nav ml-auto">
      <li class="nav-item">
        <a class="nav-link" data-toggle="modal" data-target="#newServiceModal"><%= fa_icon(:eye, text: "Novo serviço") %></a>
      </li>
      <li class="nav-item">
        <%= link_to fa_icon(:user, text: @current_user.name.split.first), edit_user_path(@current_user), class: "nav-link" %>
      </li>
      <li class="nav-item">
        <%= link_to fa_icon("sign-out-alt", text: "Sair"), logoff_path, class: "btn btn-danger" %>
      </li>
    </ul>
    <!--<form class="form-inline my-2 my-lg-0">-->
    <!--  <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">-->
    <!--  <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>-->
    <!--</form>-->
  </div>
</nav>

<!-- Modal -->
<div class="modal fade" id="newServiceModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLongTitle"></h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <%= render "monitored_services/form" %>
      </div>
    </div>
  </div>
</div>

<div id="panel-commands" class="mt-3 d-flex justify-content-end mb-1">
  <% refresh_intervals = {"segundo" => 1, "30 segundos" => 30.seconds, "minuto" => 1.minute, "10 minutos" => 10.minutes, "hora" => 1.hour} %>
  <% warning_delays = {"100ms" => 0.1.seconds, "200ms" => 0.2.seconds, "500ms" => 0.5.seconds, "1s" => 1.second} %>
  
  <%= button_to "/refresh_panel.js", remote: true, data: {"disable-with" => "Atualizando..."}, id: "refresh_bttn", class: "btn btn-success", method: :get do %>
    <%= fa_icon "sync-alt", text: "Atualizar" %>
  <% end %>
  
  <%= button_to "/force_ping.js", remote: true, data: {"disable-with" => "Pingando..."}, id: "force_ping_bttn", class: "btn btn-primary", method: :get do %>
    <%= fa_icon "play", text: "Forçar medição" %>
  <% end %>
  
  <div class="d-inline">
    <%= simple_form_for :update_refresh_delay, url: "/update_refresh_delay.js", remote: true, wrapper: :inline_form, html: { class: 'form-inline d-inline' } do |f| %>
      <%= f.input :seconds, as: :select, collection: refresh_intervals, include_blank: "Atualizações a cada:", label: false, input_html: {:onchange=>'$(this.form).submit();', title: "Tempo entre atualizações da página", "data-toggle"=>"tooltip", "data-html"=>"true", "data-placement"=>"bottom"} %>
    <% end %>
  </div>
  
  <div class="d-inline">
    <%= simple_form_for :update_warning_delay, url: "/update_warning_delay.js", remote: true, wrapper: :inline_form, html: { class: 'form-inline d-inline' } do |f| %>
      <%= f.input :seconds, as: :select, collection: warning_delays, include_blank: "Alta latência:", label: false, input_html: {:onchange=>'$(this.form).submit();', title: "Intervalo de tempo considerado de alta latência", "data-toggle"=>"tooltip", "data-html"=>"true", "data-placement"=>"bottom"} %>
    <% end %>
  </div>
</div>

<div id='service-container' class="d-flex justify-content-around flex-wrap mb-3 p-3 border rounded">
  <% @monitored_services.each do |service| %>
    <%= render partial: "monitored_service", locals: {service: service} %>
  <% end %>
</div>

<script>
  <%= render "update_refresh_delay.js" %>
</script>